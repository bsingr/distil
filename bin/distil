#!/usr/bin/env ruby

$script_dir= File.expand_path(File.join(File.dirname(__FILE__), "..", "lib"))
$vendor_dir= File.expand_path(File.join(File.dirname(__FILE__), "..", "vendor"))
$app_name= File.basename($0)

require "#{$script_dir}/project"

arg_settings= {}
project_file= "distil.yml"
args= []

ARGV.each { |v|
  if (!v[/^-/])
    args << v
    next
  end
  
  v= v.gsub(/^-+/, '')
  v.gsub!("-", "_")
  
  key,value= v.split("=")
  if (!value)
    value= true
  end
  
  if ("f"==key || "file"==key || "buildfile"==key)
    project_file= value
    next
  end
  
  arg_settings[key]= value
}

# Change working directory to the folder containing the build YML file.
project_file= File.expand_path(project_file)

if (!File.exists?(project_file))
  puts "#{$app_name}: can't find project file: #{project_file}"
  exit
end

project= Project.new(project_file, arg_settings)
project.build_external_projects
project.build_targets
